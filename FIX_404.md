# 修复 localhost:3001 返回 404 的问题

## 问题原因

当使用 `localhost:3001` 访问 API 时，系统会尝试 IPv6 (`::1`) 和 IPv4 (`127.0.0.1`)。如果 Express 后端没有正确监听 IPv6，请求可能会被其他服务（如 Nuxt）拦截。

## 解决方案

### 方案 1：使用 127.0.0.1（推荐）

直接使用 IPv4 地址访问，避免 DNS 解析和 IPv6 问题：

```bash
# ✅ 推荐使用
curl http://127.0.0.1:3001/api/auth/me

# ✅ 在浏览器中
http://127.0.0.1:3001/api/auth/me
```

### 方案 2：修复 Express 监听配置

已更新 `backend/index.js`，Express 现在会监听所有网络接口（`0.0.0.0`），包括 IPv4 和 IPv6。

**需要重启后端服务**：

```bash
# 停止当前后端服务（Ctrl+C）
# 然后重新启动
npm run server
# 或
npm run dev
```

### 方案 3：通过 Nuxt 代理访问

如果仍然有问题，可以通过 Nuxt Server API 代理访问：

```bash
# 通过 Nuxt 代理（端口 3000）
curl http://localhost:3000/api/auth/me
```

## 验证修复

重启后端后，测试：

```bash
# 测试 IPv4
curl -4 http://localhost:3001/api/health
# 应该返回: {"status":"ok","message":"Server is running"}

# 测试 IPv6
curl -6 http://localhost:3001/api/health
# 应该返回: {"status":"ok","message":"Server is running"}

# 测试认证接口
curl http://127.0.0.1:3001/api/auth/me
# 应该返回 401（未授权），而不是 404
```

## 检查响应来源

通过响应头判断请求到达了哪个服务器：

**Express 后端响应**：

```
HTTP/1.1 401 Unauthorized
X-Powered-By: Express
Content-Type: application/json; charset=utf-8
```

**Nuxt Server API 响应**：

```
HTTP/1.1 401
content-type: application/json
x-content-type-options: nosniff
x-frame-options: DENY
```

## 常见问题

### Q: 为什么使用 localhost 会慢？

A: `localhost` 需要 DNS 解析，可能优先尝试 IPv6，导致延迟。使用 `127.0.0.1` 可以避免这个问题。

### Q: 重启后端后还是 404？

A: 检查：

1. 后端服务是否真的重启了
2. 查看后端控制台是否有请求日志
3. 确认端口 3001 没有被其他服务占用

### Q: 如何确认请求到达了 Express？

A: 查看后端控制台，应该看到：

```
[2025-12-04T09:48:26.000Z] GET /api/auth/me
```

如果没有看到日志，说明请求没有到达 Express 后端。
